<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shop Game Premium - Full Detail View</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-bg: #020617;
            --glass-bg: rgba(15, 23, 42, 0.95);
            --modal-bg: #081020; 
            --neon-blue: #0ea5e9;
            --btn-green: #22c55e;
            --text-yellow: #facc15;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--primary-bg);
            color: white;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- BACKGROUND & ANIMATION --- */
        .bg-grid-dots {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1.5px, transparent 1.5px);
            background-size: 30px 30px;
            z-index: -3;
        }
        
        .flower-particle {
            position: fixed;
            z-index: 0; opacity: 0.8;
            filter: drop-shadow(0 0 5px pink);
            animation: floatDown 10s linear infinite;
        }
        @keyframes floatDown {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .notify-box {
            background: rgba(11, 17, 33, 0.95);
            border: 1px solid rgba(56, 189, 248, 0.3);
            box-shadow: 0 0 30px rgba(14, 165, 233, 0.15);
        }

        .btn-zalo {
            background: linear-gradient(180deg, #3b82f6 0%, #1e3a8a 100%);
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
            transition: transform 0.2s;
        }
        .btn-zalo:active { transform: scale(0.98); }

        .product-item {
            background-color: #050b14;
            border: 2px solid #38bdf8;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .product-item:hover {
            transform: translateY(-2px);
            border-color: #7dd3fc;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
        }
        .product-pro { border-color: #f472b6; }

        /* --- MODAL CHUNG --- */
        .custom-modal {
            transition: opacity 0.3s ease-in-out;
        }
        .hidden-modal {
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
        }
        .modal-content-anim {
            transform: scale(1);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .hidden-modal .modal-content-anim {
            transform: scale(0.9);
        }

        .modal-content {
            background-color: var(--modal-bg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            max-height: 90vh;
            overflow-y: auto;
        }

        .feature-list li {
            position: relative;
            padding-left: 24px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #e2e8f0;
            font-weight: 500;
        }
        .feature-list li::before {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            left: 0; top: 2px;
            color: #64748b;
            font-size: 12px;
        }

        .btn-buy-now, .btn-green-custom {
            background: linear-gradient(180deg, #4ade80 0%, #16a34a 100%);
            border: none;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
            transition: filter 0.2s;
        }
        .btn-buy-now:hover, .btn-green-custom:hover { filter: brightness(1.1); }

        /* --- MENU DROPDOWN GLOW --- */
        .dropdown-glow {
            background: rgba(11, 17, 33, 0.98);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        .dropdown-glow::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            border-radius: inherit;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.1);
            pointer-events: none;
        }

        /* --- AUTH & BILL MODAL --- */
        .auth-container {
            background-color: #0b1120;
            border: 1px solid rgba(56, 189, 248, 0.5); 
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.9), 0 0 15px rgba(56, 189, 248, 0.2);
        }
        .auth-input, .select-custom {
            background-color: transparent;
            border: 1px solid #e2e8f0;
            color: #f3f4f6;
            transition: all 0.3s;
        }
        .select-custom option { background-color: #0b1120; color: white; }
        
        .auth-input:focus, .select-custom:focus {
            border-color: #38bdf8;
            outline: none;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.2);
        }
        .auth-btn {
            background-color: #439b46;
            transition: background-color 0.2s;
        }
        .auth-btn:hover { background-color: #388e3b; }

        .custom-checkbox {
            appearance: none;
            width: 18px; height: 18px;
            border: 1px solid #4b5563; border-radius: 4px;
            background-color: transparent; display: inline-block;
            position: relative; cursor: pointer;
        }
        .custom-checkbox:checked {
            background-color: #38bdf8;
            border-color: #38bdf8;
        }
        .custom-checkbox:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free'; font-weight: 900;
            color: white; font-size: 12px; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        /* QR Background Gradient */
        .bg-qr-gradient {
            background: linear-gradient(180deg, #4f46e5 0%, #a855f7 100%);
        }
        .qr-list i {
            width: 24px;
            text-align: center; font-size: 16px; margin-right: 6px;
        }

        /* T√πy ch·ªânh n√∫t Sidebar */
        .sidebar-btn {
            background-color: #d1d5db;
            color: #1f2937; 
            border-radius: 9999px;
            padding: 14px 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, filter 0.2s;
            width: 100%;
        }
        .sidebar-btn:active { transform: scale(0.98); }
        .sidebar-btn i { font-size: 18px; color: #374151; }

        /* T√πy ch·ªânh icon thao t√°c trong L·ªãch s·ª≠ ƒë∆°n h√†ng */
        .action-icon-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center; justify-content: center;
            font-size: 12px; transition: all 0.2s;
            background: transparent;
        }
        .action-icon-btn:hover { background: rgba(255,255,255,0.1); }
        
        /* Ch·ªõp nh√°y cho ch·ªØ "ƒêang ch·ªù thanh to√°n" */
        @keyframes pulse-text {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .animate-pulse-text { animation: pulse-text 1.5s infinite; }
    </style>
</head>

<body class="flex flex-col min-h-screen relative">

    <div class="bg-grid-dots"></div>
    <div class="flower-particle text-xl" style="left: 10%; animation-delay: 0s;">üå∏</div>
    <div class="flower-particle text-2xl" style="right: 15%; animation-delay: 2s;">üå∏</div>
    <div class="flower-particle text-lg" style="left: 40%; animation-delay: 4s;">üå∏</div>
    <div class="flower-particle text-xl" style="right: 5%; animation-delay: 1s;">üå∏</div>

    <header class="fixed top-0 w-full z-40 glass-panel h-16">
        <div class="container mx-auto px-4 h-full flex justify-between items-center">
            <div class="flex items-center gap-4">
                <button onclick="openSidebarMenu()" class="text-gray-400 hover:text-white transition text-2xl"><i class="fa-solid fa-bars"></i></button>
                <div class="w-10 h-10 rounded-xl overflow-hidden border border-gray-600">
                    <img src="https://cdn-icons-png.flaticon.com/512/3408/3408506.png" class="w-full h-full object-cover">
                </div>
            </div>
          
            <div class="flex items-center gap-3 relative">
                <div class="relative w-9 h-9 rounded-xl flex items-center justify-center border border-gray-400 bg-transparent">
                    <i class="fa-regular fa-bell text-gray-300 text-lg"></i>
                    <span class="absolute top-1 right-1.5 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                </div>
                
                <div class="relative">
                    <div id="user-header-btn" onclick="toggleUserMenu(event)" class="flex items-center gap-2 cursor-pointer hover:opacity-80 transition">
                        <img src="https://img.freepik.com/premium-photo/3d-avatar-boy-character_914455-603.jpg" class="w-10 h-10 rounded-full border border-gray-600">
                        <div class="flex flex-col leading-tight" id="user-header-info">
                        </div>
                    </div>

                    <div id="user-dropdown" class="absolute top-full right-0 mt-3 w-48 rounded-[14px] z-50 hidden opacity-0 scale-95 transition-all duration-200 transform origin-top-right dropdown-glow">
                        <div class="flex flex-col p-1.5 space-y-1" id="dropdown-content">
                        </div>
                    </div>
                </div>
            </div>
         </div>
    </header>
    <div class="h-20"></div>

    <main class="container mx-auto px-4 pb-20 max-w-2xl flex-grow">
        
        <div class="mb-6">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">Trang ch·ªß</h1>
            <div class="flex items-center gap-2 text-sm text-gray-400">
                <span>Trang Ch·ªß</span> <i class="fa-solid fa-chevron-right text-[10px]"></i> <span class="text-green-500">S·∫£n Ph·∫©m</span>
            </div>
        </div>

        <div class="notify-box rounded-2xl p-6 mb-8 relative overflow-hidden">
            <div class="text-center mb-6">
                <h2 class="text-yellow-400 font-bold text-lg uppercase flex items-center justify-center gap-2">
                    <i class="fa-solid fa-triangle-exclamation animate-pulse"></i> TH√îNG B√ÅO QUAN TR·ªåNG <i class="fa-solid fa-triangle-exclamation animate-pulse"></i>
                </h2>
                <p class="text-gray-300 text-sm mt-2">Nh·ªØng tr∆∞·ªùng h·ª£p b·ªã kh√≥a t√†i kho·∫£n vui l√≤ng li√™n h·ªá admin ƒë·ªÉ ƒë∆∞·ª£c ho√†n file kh√°c.</p>
            </div>
        
            <div class="flex flex-col items-center gap-2 mb-6">
                <span class="text-gray-400 text-sm font-bold"><i class="fa-solid fa-mobile-screen"></i> ZALO ADMIN:</span>
                <a href="https://zalo.me/0905564558" class="btn-zalo w-full max-w-[250px] py-3 rounded-lg text-white font-bold text-xl text-center tracking-widest border border-blue-400">0905564558</a>
            </div>

            <div class="space-y-3 border-t border-gray-700 pt-4 text-sm">
                <div class="flex justify-between border-b border-gray-800 pb-2 border-dashed">
                    <span class="text-gray-300"><i class="fa-solid fa-paperclip w-5"></i> T·ªïng h·ª£p link t·∫£i:</span>
                    <span class="text-cyan-400 font-bold cursor-pointer">Nh·∫•n v√†o ƒë√¢y</span>
                </div>
                <div class="flex justify-between border-b border-gray-800 pb-2 border-dashed">
                    <span class="text-gray-300"><i class="fa-solid fa-wrench w-5"></i> C√°ch fix l·ªói log acc:</span>
                    <span class="text-cyan-400 font-bold cursor-pointer">Nh·∫•n v√†o ƒë√¢y</span>
                </div>
                <div class="flex justify-between border-b border-gray-800 pb-2 border-dashed">
                    <span class="text-gray-300"><i class="fa-regular fa-comments w-5"></i> C√°c box c·ªßa admin:</span>
                    <span class="text-cyan-400 font-bold cursor-pointer">Nh·∫•n v√†o ƒë√¢y</span>
                </div>
            </div>

            <div class="mt-6 text-center">
                <p class="text-[10px] text-gray-500 uppercase font-bold mb-3">Shop t·ª± ƒë·ªông 100% n·∫°p bank auto 24/7</p>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="openTopupCardModal()" class="bg-[#2e1065] border border-purple-500 text-white py-2 rounded-lg font-bold text-sm"><i class="fa-solid fa-credit-card text-yellow-300"></i> N·∫°p Card</button>
                    <button onclick="openTopupBankModal()" class="bg-[#172554] border border-blue-500 text-white py-2 rounded-lg font-bold text-sm"><i class="fa-solid fa-building-columns text-green-300"></i> N·∫°p Bank</button>
                </div>
            </div>
        </div>

        <div>
            <div class="bg-gradient-to-r from-emerald-500 to-teal-600 py-3 px-4 rounded-t-xl flex items-center justify-between relative overflow-hidden shadow-lg shadow-emerald-500/20">
                <div class="flex items-center gap-2 text-white font-bold uppercase relative z-10">
                    <i class="fa-solid fa-cart-shopping"></i> T·∫•t c·∫£ s·∫£n ph·∫©m
                </div>
                <i class="fa-solid fa-leaf text-white/20 text-3xl absolute right-2 top-0 rotate-12"></i>
            </div>
            <div class="flex flex-col gap-3 mt-4" id="product-list"></div>
        </div>
    </main>

    <div id="sidebar-modal" class="fixed inset-0 z-[150] custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeSidebarMenu()"></div>
        <div class="absolute top-4 right-4 z-10">
            <button onclick="closeSidebarMenu()" class="bg-[maroon] text-white border-2 border-white w-10 h-10 flex items-center justify-center rounded transition hover:bg-red-700 text-xl font-bold">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div class="relative w-full max-w-sm mx-auto mt-24 px-4 flex flex-col z-10 modal-content-anim">
            <button onclick="closeSidebarMenu()" class="sidebar-btn"><i class="fa-solid fa-house"></i> Trang Ch·ªß</button>
            <button onclick="openOrdersModal(); closeSidebarMenu()" class="sidebar-btn"><i class="fa-solid fa-receipt"></i> ƒê∆°n h√†ng</button>
            <button onclick="openTopupBankModal(); closeSidebarMenu()" class="sidebar-btn"><i class="fa-solid fa-building-columns"></i> N·∫°p qua Ng√¢n h√†ng</button>
            <button onclick="openTopupCardModal(); closeSidebarMenu()" class="sidebar-btn"><i class="fa-solid fa-credit-card"></i> N·∫°p qua Th·∫ª c√†o</button>
            <button id="admin-menu-btn" onclick="openAdminModal(); closeSidebarMenu()" class="sidebar-btn hidden"><i class="fa-solid fa-screwdriver-wrench text-red-600"></i> Menu qu·∫£n tr·ªã vi√™n</button>
        </div>
    </div>

    <div id="orders-modal" class="fixed inset-0 z-[140] flex items-center justify-center px-2 sm:px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeOrdersModal()"></div>
        <div class="auth-container modal-content-anim w-full max-w-3xl rounded-xl relative z-10 p-4 sm:p-6 border-cyan-400 overflow-y-auto max-h-[90vh]">
            
            <div class="mb-4">
                <h2 class="text-white font-bold text-lg">Trang ch·ªß</h2>
                <p class="text-gray-400 text-sm font-medium">L·ªãch s·ª≠ mua h√†ng</p>
            </div>

            <div class="border border-cyan-500 rounded-xl p-4 sm:p-5">
                <h3 class="text-cyan-400 font-bold mb-4">L·ªãch s·ª≠ mua h√†ng</h3>
                
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4">
                    <input type="text" placeholder="M√£ ƒë∆°n h√†ng" class="auth-input bg-transparent w-full px-4 py-2 rounded-lg text-sm">
                    <input type="text" placeholder="T√¨m theo chi ph√≠" class="auth-input bg-transparent w-full px-4 py-2 rounded-lg text-sm">
                    <input type="text" placeholder="" class="auth-input bg-transparent w-full px-4 py-2 rounded-lg text-sm">
                </div>
                
                <div class="flex gap-3 mb-6">
                    <button class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg flex items-center gap-2 text-sm font-bold transition">
                        <i class="fa-solid fa-magnifying-glass"></i> T√¨m ki·∫øm
                    </button>
                    <button class="bg-[#d32f2f] hover:bg-red-700 text-white px-5 py-2 rounded-lg flex items-center gap-2 text-sm font-bold transition">
                        <i class="fa-solid fa-xmark"></i> B·ªè l·ªçc
                    </button>
                </div>

                <div class="overflow-x-auto w-full mb-4 border border-gray-700 rounded-lg">
                    <div class="min-w-[600px] w-full">
                        <div class="grid grid-cols-[50px_120px_1fr_1fr] gap-4 p-4 border-b border-gray-700 text-white font-bold text-sm">
                            <div class="flex items-center justify-center">
                                <input type="checkbox" class="custom-checkbox">
                            </div>
                            <div class="text-center">Thao t√°c</div>
                            <div>M√£ ƒë∆°n h√†ng</div>
                            <div>S·∫£n ph·∫©m</div>
                        </div>
                        
                        <div id="orders-list-container" class="text-white text-sm font-medium">
                        </div>
                    </div>
                </div>

                <button onclick="alert('ƒê√£ x√≥a c√°c ƒë∆°n h√†ng ƒë∆∞·ª£c ch·ªçn!')" class="bg-[#d32f2f] hover:bg-red-700 text-white px-5 py-2.5 rounded-lg flex items-center gap-2 text-sm font-bold transition">
                    <i class="fa-solid fa-trash-can"></i> X√≥a ƒë√£ ch·ªçn
                </button>
            </div>
            
            <button onclick="closeOrdersModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white transition text-2xl">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
    </div>

    <div id="admin-modal" class="fixed inset-0 z-[160] flex items-center justify-center px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAdminModal()"></div>
        <div class="auth-container modal-content-anim w-full max-w-[450px] rounded-xl relative z-10 p-6 border-red-500 overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center border-b border-gray-700 pb-3 mb-4">
                <h2 class="text-xl font-bold text-red-500 uppercase"><i class="fa-solid fa-user-shield"></i> Qu·∫£n Tr·ªã Vi√™n</h2>
                <button onclick="closeAdminModal()" class="text-gray-400 hover:text-white text-xl"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="bg-[#050b14] p-4 rounded-lg border border-gray-700 mb-4">
                <h3 class="text-yellow-400 font-bold mb-2 text-sm">1. X·ª≠ l√Ω API n·∫°p l·ªói</h3>
                <p class="text-gray-400 text-xs mb-3">Qu√©t v√† duy·ªát t·ª± ƒë·ªông c√°c th·∫ª c√†o ho·∫∑c h√≥a ƒë∆°n ng√¢n h√†ng ƒëang b·ªã k·∫πt h·ªá th·ªëng.</p>
                <button onclick="adminProcessTopup()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 w-full rounded transition text-sm">X·ª≠ l√Ω N·∫°p Card/Bank ngay</button>
            </div>
            <div class="bg-[#050b14] p-4 rounded-lg border border-gray-700 mb-4">
                <h3 class="text-green-400 font-bold mb-2 text-sm">2. C·ªông ti·ªÅn User</h3>
                <input type="text" id="admin-add-user" placeholder="Nh·∫≠p Username kh√°ch h√†ng" class="auth-input w-full px-3 py-2 rounded text-sm mb-2">
                <input type="number" id="admin-add-amount" placeholder="S·ªë ti·ªÅn c·∫ßn c·ªông (VD: 50000)" class="auth-input w-full px-3 py-2 rounded text-sm mb-3">
                <button onclick="adminAddBalance()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 w-full rounded transition text-sm">Th·ª±c hi·ªán C·ªông Ti·ªÅn</button>
            </div>
            <div class="bg-[#050b14] p-4 rounded-lg border border-red-900 mb-2">
                <h3 class="text-red-400 font-bold mb-2 text-sm">3. X√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n User</h3>
                <input type="text" id="admin-del-user" placeholder="Nh·∫≠p Username c·∫ßn x√≥a" class="auth-input w-full px-3 py-2 rounded text-sm mb-3 border-red-800">
                <button onclick="adminDeleteUser()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 w-full rounded transition text-sm"><i class="fa-solid fa-trash-can"></i> X√≥a T√†i Kho·∫£n N√†y</button>
            </div>
        </div>
    </div>

    <div id="product-modal" class="fixed inset-0 z-[100] flex items-center justify-center px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeProductModal()"></div>
        <div class="modal-content modal-content-anim w-full max-w-md rounded-2xl relative z-10 flex flex-col p-1 overflow-hidden">
            <button onclick="closeProductModal()" class="absolute top-3 right-3 z-50 text-white/50 hover:text-white bg-black/30 rounded-full w-8 h-8 flex items-center justify-center transition"><i class="fa-solid fa-xmark"></i></button>
            <div class="relative w-full h-48 md:h-56 bg-gray-900 rounded-t-xl overflow-hidden group">
                <img id="modal-img" src="" class="w-full h-full object-cover group-hover:scale-110 transition duration-700" alt="Product Image">
                <div class="absolute bottom-0 left-0 w-full h-20 bg-gradient-to-t from-[#081020] to-transparent"></div>
            </div>
            <div class="bg-[#081020] px-6 pb-6 pt-2 rounded-b-xl relative z-10">
                <h2 id="modal-title" class="text-center text-yellow-400 font-bold text-xl uppercase mb-6 drop-shadow-md"></h2>
                <ul id="modal-features" class="feature-list space-y-2 mb-6 pl-2"></ul>
                <div class="grid grid-cols-3 gap-2 mb-6 text-center">
                    <div><div class="text-gray-400 text-xs font-medium mb-1">C√≤n l·∫°i</div><div id="modal-stock" class="text-white font-rajdhani font-bold text-lg">0</div></div>
                    <div><div class="text-gray-400 text-xs font-medium mb-1">ƒê√£ b√°n</div><div id="modal-sold" class="text-white font-rajdhani font-bold text-lg">0</div></div>
                    <div><div class="text-gray-400 text-xs font-medium mb-1">Gi√°</div><div id="modal-price" class="text-yellow-500 font-rajdhani font-bold text-lg">0ƒë</div></div>
                </div>
                <button onclick="buyProduct()" class="btn-buy-now w-full py-3.5 rounded-lg text-white font-bold text-base uppercase tracking-wider flex items-center justify-center gap-2">
                    <i class="fa-solid fa-cart-shopping"></i> Mua ngay
                </button>
            </div>
        </div>
    </div>

    <div id="login-modal" class="fixed inset-0 z-[110] flex items-center justify-center px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAuthModals()"></div>
        <div class="auth-container modal-content-anim w-full max-w-[400px] rounded-xl relative z-10 p-6">
            <h2 class="text-xl font-bold text-white mb-6">ƒêƒÉng Nh·∫≠p T√†i Kho·∫£n</h2>
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-gray-200 text-sm font-bold mb-2">T√†i kho·∫£n:</label>
                    <input type="text" id="login-username" required placeholder="Nh·∫≠p t√†i kho·∫£n" class="auth-input bg-[#050b14] w-full px-4 py-3 rounded-lg text-sm">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-200 text-sm font-bold mb-2">M·∫≠t kh·∫©u:</label>
                    <input type="password" id="login-password" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u" class="auth-input bg-[#050b14] w-full px-4 py-3 rounded-lg text-sm">
                </div>
                <div class="flex items-center justify-between mb-6">
                    <label class="flex items-center cursor-pointer gap-2">
                        <input type="checkbox" id="login-remember" class="custom-checkbox" checked>
                        <span class="text-gray-400 text-sm">L∆∞u phi√™n</span>
                    </label>
                    <a href="#" class="text-gray-400 text-sm hover:text-white transition">Qu√™n m·∫≠t kh·∫©u ?</a>
                </div>
                <button type="submit" class="auth-btn w-full py-3 rounded-lg text-white font-bold text-base mb-4">ƒêƒÉng Nh·∫≠p</button>
            </form>
            <div class="text-center mt-2">
                <span class="text-gray-400 text-sm">Kh√¥ng c√≥ t√†i kho·∫£n?</span>
                <button onclick="switchAuthModal('register')" class="text-cyan-400 font-bold text-sm hover:text-cyan-300">ƒêƒÉng K√Ω</button>
            </div>
        </div>
    </div>

    <div id="register-modal" class="fixed inset-0 z-[110] flex items-center justify-center px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAuthModals()"></div>
        <div class="auth-container modal-content-anim w-full max-w-[400px] rounded-xl relative z-10 p-6 border-cyan-400">
            <h2 class="text-xl font-bold text-white mb-6">ƒêƒÉng K√Ω T√†i Kho·∫£n</h2>
            <form id="register-form" onsubmit="handleRegister(event)">
                <div class="mb-4">
                    <label class="block text-gray-200 text-sm font-bold mb-2">Email:</label>
                    <input type="email" id="reg-email" required placeholder="Nh·∫≠p t√†i kho·∫£n" class="auth-input bg-[#050b14] w-full px-4 py-3 rounded-lg text-sm">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-200 text-sm font-bold mb-2">T√†i kho·∫£n:</label>
                    <input type="text" id="reg-username" required placeholder="Nh·∫≠p t√†i kho·∫£n" class="auth-input bg-[#050b14] w-full px-4 py-3 rounded-lg text-sm">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-200 text-sm font-bold mb-2">M·∫≠t kh·∫©u:</label>
                    <input type="password" id="reg-password" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u" class="auth-input bg-[#050b14] w-full px-4 py-3 rounded-lg text-sm">
                </div>
                <button type="submit" class="auth-btn w-full py-3 rounded-lg text-white font-bold text-base mb-4">ƒêƒÉng K√Ω</button>
            </form>
            <div class="text-center mt-2">
                <span class="text-gray-400 text-sm">ƒê√£ c√≥ t√†i kho·∫£n?</span>
                <button onclick="switchAuthModal('login')" class="text-cyan-400 font-bold text-sm hover:text-cyan-300">ƒêƒÉng Nh·∫≠p</button>
            </div>
        </div>
    </div>

    <div id="topup-card-modal" class="fixed inset-0 z-[110] flex items-center justify-center px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAllTopupModals()"></div>
        <div class="auth-container modal-content-anim w-full max-w-[400px] rounded-xl relative z-10 p-6 border-cyan-400 overflow-y-auto max-h-[90vh]">
            <h2 class="text-lg font-bold text-cyan-400 mb-4">N·∫°p Th·∫ª C√†o T·ª± ƒê·ªông:</h2>
            <form onsubmit="handleTopupCard(event)">
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">Nh√† m·∫°ng :</label>
                    <select class="select-custom w-full px-4 py-3 rounded-lg text-sm cursor-pointer" required>
                        <option value="" disabled selected hidden>Ch·ªçn nh√† m·∫°ng</option>
                        <option value="VIETTEL">Viettel</option>
                        <option value="VINAPHONE">Vinaphone</option>
                        <option value="MOBIFONE">Mobifone</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">M·ªánh gi√° :</label>
                    <select id="card-value" onchange="calculateCardDiscount()" class="select-custom w-full px-4 py-3 rounded-lg text-sm cursor-pointer" required>
                        <option value="" disabled selected hidden>Ch·ªçn m·ªánh gi√°</option>
                        <option value="10000">10.000ƒë</option>
                        <option value="20000">20.000ƒë</option>
                        <option value="50000">50.000ƒë</option>
                        <option value="100000">100.000ƒë</option>
                        <option value="200000">200.000ƒë</option>
                        <option value="500000">500.000ƒë</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">Serial :</label>
                    <input type="text" required placeholder="Nh·∫≠p serial" class="auth-input w-full px-4 py-3 rounded-lg text-sm">
                </div>
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">M√£ th·∫ª :</label>
                    <input type="text" required placeholder="Nh·∫≠p m√£ th·∫ª" class="auth-input w-full px-4 py-3 rounded-lg text-sm">
                </div>
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">M√£ b·∫£o v·ªá :</label>
                    <div class="flex items-center gap-2">
                        <input type="text" required placeholder="Nh·∫≠p m√£ b·∫£o v·ªá" class="auth-input w-[60%] px-4 py-3 rounded-lg text-sm">
                        <div class="bg-gray-200 text-red-600 font-bold text-lg px-4 py-2 rounded flex-1 text-center" id="captcha-display">395</div>
                        <button type="button" onclick="refreshCaptcha()" class="bg-transparent border border-gray-600 text-green-500 rounded p-3 hover:bg-white/10 transition">
                            <i class="fa-solid fa-arrows-rotate"></i>
                        </button>
                    </div>
                </div>
                <div class="mb-6"><p class="text-white font-bold text-sm">S·ªë ti·ªÅn th·ª±c nh·∫≠n: <span id="card-discount-amount" class="text-red-500">0ƒë</span></p></div>
                <button type="submit" class="btn-green-custom w-full max-w-[150px] py-3 rounded-lg text-white font-bold text-base">N·∫°p Ngay</button>
            </form>
        </div>
    </div>

    <div id="topup-bank-modal" class="fixed inset-0 z-[110] flex items-center justify-center px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAllTopupModals()"></div>
        <div class="auth-container modal-content-anim w-full max-w-[400px] rounded-xl relative z-10 p-6 border-cyan-400">
            <h2 class="text-cyan-400 font-bold text-lg">N·∫°p ATM t·ª± ƒë·ªông</h2>
            <p class="text-white text-xs mb-4">Trang Ch·ªß &nbsp;>&nbsp; <span class="text-green-500">N·∫°p ATM T·ª± ƒê·ªông</span></p>
            <div class="border border-green-500 rounded-lg p-3 mb-6 text-white font-bold text-sm bg-transparent">N·∫†P T·ª∞ ƒê·ªòNG 24/7</div>
            <h3 class="text-cyan-400 font-bold mb-2">T·∫°o h√≥a ƒë∆°n ng√¢n h√†ng</h3>
            <div class="border border-cyan-500 rounded-xl p-6 flex flex-col items-center">
                <div class="w-32 h-32 mb-6 relative">
                    <img src="https://cdn-icons-png.flaticon.com/512/2830/2830284.png" alt="Bank" class="w-full h-full object-contain filter invert opacity-90 drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]">
                    <i class="fa-solid fa-dollar-sign absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-[40%] text-4xl text-yellow-600"></i>
                </div>
                <button onclick="openInvoiceModal()" class="btn-green-custom w-full py-3 rounded-lg text-white font-bold">T·∫°o h√≥a ƒë∆°n</button>
            </div>
        </div>
    </div>

    <div id="invoice-modal" class="fixed inset-0 z-[120] flex items-center justify-center px-4 custom-modal hidden-modal">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeInvoiceModal()"></div>
        <div class="auth-container modal-content-anim w-full max-w-[400px] rounded-xl relative z-10 p-6 border-cyan-400">
            <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-2">
                <h2 class="text-white font-bold text-lg">T·∫°o h√≥a ƒë∆°n</h2>
                <button onclick="closeInvoiceModal()" class="text-gray-400 hover:text-white transition text-xl"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <label class="block text-white font-bold text-sm mb-3">S·ªë ti·ªÅn - V√≠ d·ª•: 10000 : <span class="text-red-500">*</span></label>
            <input type="number" id="invoice-amount" placeholder="S·ªë ti·ªÅn c·∫ßn n·∫°p" class="auth-input bg-transparent w-full px-4 py-3 rounded-lg mb-6 text-sm">
            <button onclick="generateBankQR()" class="btn-green-custom w-full py-3 rounded-lg text-white font-bold">T·∫°o h√≥a ƒë∆°n</button>
        </div>
    </div>

    <div id="qr-modal" class="fixed inset-0 z-[130] flex items-center justify-center custom-modal hidden-modal bg-qr-gradient overflow-y-auto">
        <div class="w-full max-w-[420px] p-4 flex flex-col items-center min-h-screen py-10">
            <h1 class="text-3xl font-bold text-[#818cf8] mb-2 uppercase drop-shadow-md">N·∫†P BANK</h1>
            <p class="text-white text-sm mb-6 text-center">S·ª≠ d·ª•ng App Internet Banking ho·∫∑c camera ƒë·ªÉ qu√©t m√£ QR</p>
           
            <div class="bg-white rounded-[24px] p-6 w-full shadow-2xl relative">
                <h2 class="text-blue-600 font-bold text-lg mb-4">Qu√©t M√£ QR ƒê·ªÉ Thanh To√°n</h2>
                <ul class="space-y-3 mb-6 text-gray-800 text-sm font-bold qr-list">
                    <li class="flex items-center"><i class="fa-solid fa-building-columns text-blue-500"></i> Ng√¢n H√†ng:MBBANK</li>
                    <li class="flex items-center"><i class="fa-regular fa-credit-card text-blue-700"></i> S·ªë t√†i kho·∫£n:0905564558</li>
                    <li class="flex items-center"><i class="fa-solid fa-user text-blue-500"></i> Ch·ªß t√†i kho·∫£n:NGUYEN DUY PHUOC TAI</li>
                    <li class="flex items-center"><i class="fa-solid fa-circle-dollar-to-slot text-green-600"></i> <span class="text-green-600">S·ªë ti·ªÅn:<span id="qr-display-amount">0ƒë</span></span></li>
                    <li class="flex items-center"><i class="fa-regular fa-pen-to-square text-orange-400"></i> N·ªôi dung CK:<span id="qr-display-content" class="text-gray-800 ml-1"></span></li>
                    <li class="flex items-center"><i class="fa-solid fa-hourglass-half text-yellow-600"></i> <span id="qr-status-text" class="text-yellow-600 animate-pulse-text">Tr·∫°ng th√°i: ƒêang ch·ªù thanh to√°n...</span></li>
                </ul>
                <div class="border-2 border-purple-400 rounded-2xl p-3 flex justify-center mb-2">
                    <img id="qr-dynamic-img" src="" class="w-56 h-56 object-contain" alt="QR Code">
                </div>
            </div>
            <p class="text-white text-center mt-6 text-sm px-4">H·ªá th·ªëng ƒëang ki·ªÉm tra t·ª± ƒë·ªông b·∫±ng API. Vui l√≤ng thanh to√°n trong v√≤ng 15 ph√∫t.</p>
            <button onclick="closeQRModal()" class="bg-blue-600 hover:bg-blue-700 transition text-white font-bold py-3 px-8 rounded-lg mt-4 shadow-lg">ƒê√≥ng (Quay L·∫°i)</button>
        </div>
    </div>

    <script>
        // --- BI·∫æN TO√ÄN C·ª§C L∆ØU S·∫¢N PH·∫®M ƒêANG CH·ªåN ---
        let currentSelectedProduct = null;

        // --- DATA S·∫¢N PH·∫®M ---
        const productsData = [
            { id: 1, name: "IPA FFMAX TR·∫ÆNG + FILE AIM", icon: "fa-crosshairs", color: "cyan", imgUrl: "https://i.ytimg.com/vi/Wk9q6QzEw_I/maxresdefault.jpg", detailTitle: "IPA TR·∫ÆNG + AIM BODY", features: ["IPA C√ì ƒê·∫†N TH·∫≤NG S·∫¥N", "IPA KH√îNG C√ì KEY", "IPA ANTIBAN BYPASS", "K√àM FILE AIM BODY ƒê·ªÇ D√ÅN", "ANTI KH√îNG BAN ID", "CH∆†I ƒê∆Ø·ª¢C ALL MAP", "C√ÄI ƒê∆Ø·ª¢C T·∫§T C·∫¢ IOS"], stock: 8, sold: 7, price: "100.000ƒë" },
            { id: 2, name: "IPA AIMKILL OB52", icon: "fa-dragon", color: "purple", isHot: true, imgUrl: "https://img.youtube.com/vi/zZ-wVuvk1G8/maxresdefault.jpg", detailTitle: "KEY TU·∫¶N MENU AIMKILL", features: ["ESP, AIMBOT, FOV 360, AIMKILL", "GHOST, NINJA, AIR, HIDE DAME", "AIM SILENT, AUTO FIRE, TELE", "C√ì MOD SKIN TRONG MENU", "KH√îNG BAN ID, K√âO RANK ƒê∆Ø·ª¢C", "C√ÄI ƒê∆Ø·ª¢C CHO T·∫§T C·∫¢ IOS"], stock: 19, sold: 150, price: "70.000ƒë" },
            { id: 3, name: "MENU MIGUL LITE", icon: "fa-bolt", color: "white", imgUrl: "https://i.ytimg.com/vi/6qQvQ1d7_5o/maxresdefault.jpg", detailTitle: "KEY NG√ÄY MIGUL LITE", features: ["ƒê·ªäNH V·ªä ESP, AIMBOT GHIM ƒê·∫¶U", "AIM FOV 360 ƒê·ªò SI√äU D√çNH", "ƒê·∫†N TH·∫≤NG, BUFF 120 FPS", "·∫®N M√ÄN C√ÇN K√àO TI·ªÄN", "MU·ªêN AIMKILL, SILENT IB AD", "CH∆†I ƒê·ªòI K√âO RANK ƒê∆Ø·ª¢C", "C√ÄI ƒê∆Ø·ª¢C CHO T·∫§T C·∫¢ IOS"], stock: 8, sold: 191, price: "50.000ƒë" },
            { id: 4, name: "MENU MIGUL PRO", icon: "fa-crown", color: "red", isPro: true, imgUrl: "https://i.ytimg.com/vi/uE-3D8Jd4k0/maxresdefault.jpg", detailTitle: "KEY NG√ÄY MIGUL PRO", features: ["AIMBOT, AIM SILENT, ESP VIP", "ƒê·∫†N TH·∫≤NG, N·∫†P ƒê·∫†N NHANH", "CH·∫†Y NHANH, K√âO ƒê·ªäCH, 120FPS", "B∆†M M√ÅU NHANH, D·ªäCH CHUY·ªÇN", "NH·∫¢Y D√ô NHANH, ƒê·ªîI S√öNG NHANH", "KH√îNG BAN ID, C√ì TH·ªÇ K√âO RANK", "C√ÄI ƒê∆Ø·ª¢C CHO ALL PHI√äN B·∫¢N IOS", "KHI MUA G·ª¨I M√É ƒê∆†N L·∫§Y IPA + KEY"], stock: 5, sold: 15, price: "75.000ƒë" }
        ];

        // --- DATA ƒê∆†N H√ÄNG ---
        const orderHistoryData = [
            { id: "WA7U", product: "KEY TU·∫¶N MIGUL PRO" },
            { id: "UJBT", product: "ƒê·ªäNH V·ªä ANDROID OB51" },
            { id: "W7A3", product: "FFMAX C√ÇN CHECK R8 NEW" },
            { id: "GDAA97E", product: "IPA TR·∫ÆNG + AIM BODY" },
            { id: "S5QD", product: "MENU + KEY 1 TU·∫¶N" }
        ];

        // --- RENDER LIST S·∫¢N PH·∫®M TRANG CH·ª¶ ---
        const listContainer = document.getElementById('product-list');
        productsData.forEach(product => {
            const div = document.createElement('div');
            let borderClass = product.isPro ? 'product-pro' : '';
            let iconColor = product.id === 4 ? 'text-red-400' : (product.id === 1 ? 'text-cyan-400' : (product.id === 2 ? 'text-purple-400' : 'text-green-400'));
            div.className = `product-item rounded-xl p-3 flex items-center gap-4 h-16 relative overflow-hidden group ${borderClass}`;
       
            div.onclick = () => openProductModal(product);
            div.innerHTML = `
                <div class="w-10 h-10 bg-slate-800 rounded flex items-center justify-center flex-shrink-0 border border-slate-700"><i class="fa-solid ${product.icon} ${iconColor} text-lg"></i></div>
                <div class="flex-grow z-10"><h4 class="font-bold text-gray-100 text-sm md:text-base group-hover:text-cyan-400 transition">${product.name}</h4>
                ${product.isHot ? '<div class="absolute right-2 top-1"><i class="fa-solid fa-fire text-red-500 text-xs animate-pulse"></i></div>' : ''}
                ${product.isPro ? '<div class="absolute top-0 right-0 bg-red-600 text-white text-[9px] font-bold px-2 py-0.5 rounded-bl-lg">PRO</div>' : ''}</div>
                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition duration-700"></div>
            `;
            listContainer.appendChild(div);
        });

        // --- RENDER B·∫¢NG L·ªäCH S·ª¨ ƒê∆†N H√ÄNG ---
        function renderOrderHistory() {
            const orderContainer = document.getElementById('orders-list-container');
            orderContainer.innerHTML = ''; // Xo√° d·ªØ li·ªáu c≈©

            orderHistoryData.forEach(order => {
                const row = document.createElement('div');
                row.className = "grid grid-cols-[50px_120px_1fr_1fr] gap-4 p-4 border-b border-gray-700 items-center hover:bg-white/5 transition";
                
                row.innerHTML = `
                    <div class="flex items-center justify-center">
                        <input type="checkbox" class="custom-checkbox">
                    </div>
                    <div class="flex items-center justify-center gap-2">
                        <button class="action-icon-btn border border-gray-500 text-gray-400 hover:text-white" title="Xem"><i class="fa-regular fa-eye"></i></button>
                        <button class="action-icon-btn border border-green-500 text-green-500 hover:text-green-400" title="T·∫£i xu·ªëng"><i class="fa-solid fa-download"></i></button>
                        <button class="action-icon-btn border border-red-500 text-red-500 hover:text-red-400" title="X√≥a"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                    <div class="truncate font-bold">${order.id}</div>
                    <div class="truncate uppercase leading-tight">${order.product}</div>
                `;
                orderContainer.appendChild(row);
            });
        }

        // --- M·ªû/ƒê√ìNG MODAL L·ªäCH S·ª¨ ƒê∆†N H√ÄNG ---
        const ordersModal = document.getElementById('orders-modal');
        function openOrdersModal() {
            if(localStorage.getItem('isLoggedIn') !== 'true') { alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem l·ªãch s·ª≠ mua h√†ng!'); return; }
            renderOrderHistory();
            ordersModal.classList.remove('hidden-modal');
        }
        function closeOrdersModal() { ordersModal.classList.add('hidden-modal'); }

        // --- MODAL S·∫¢N PH·∫®M & T√çNH NƒÇNG MUA NGAY ---
        const productModal = document.getElementById('product-modal');
        
        function openProductModal(product) {
            currentSelectedProduct = product; // L∆∞u l·∫°i bi·∫øn to√†n c·ª•c ƒë·ªÉ h√†m buyProduct s·ª≠ d·ª•ng
            document.getElementById('modal-img').src = product.imgUrl; 
            document.getElementById('modal-title').innerText = product.detailTitle;
            document.getElementById('modal-stock').innerText = product.stock; 
            document.getElementById('modal-sold').innerText = product.sold;
            document.getElementById('modal-price').innerText = product.price;
            
            const featuresList = document.getElementById('modal-features'); 
            featuresList.innerHTML = '';
            product.features.forEach(feat => { const li = document.createElement('li'); li.innerText = feat; featuresList.appendChild(li); });
            
            productModal.classList.remove('hidden-modal');
        }
        
        function closeProductModal() { 
            productModal.classList.add('hidden-modal'); 
        }

        // X·ª≠ l√Ω khi ·∫•n n√∫t "MUA NGAY"
        function buyProduct() {
            // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
            if(localStorage.getItem('isLoggedIn') !== 'true') {
                alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ mua s·∫£n ph·∫©m!');
                closeProductModal();
                openAuthModal('login');
                return;
            }

            if(!currentSelectedProduct) return;

            // X·ª≠ l√Ω l√†m s·∫°ch chu·ªói gi√° ti·ªÅn (VD: "100.000ƒë" -> 100000)
            let priceStr = currentSelectedProduct.price.replace(/\D/g, ''); 
            let productPrice = parseInt(priceStr);
            let currentBalance = parseInt(localStorage.getItem('user_balance') || '0');

            // Ki·ªÉm tra s·ªë d∆∞
            if(currentBalance < productPrice) {
                alert(`L·ªói! S·ªë d∆∞ c·ªßa b·∫°n kh√¥ng ƒë·ªß ƒë·ªÉ mua s·∫£n ph·∫©m n√†y.\nGi√° s·∫£n ph·∫©m: ${formatVND(productPrice)}ƒë\nS·ªë d∆∞ hi·ªán t·∫°i: ${formatVND(currentBalance)}ƒë\n\nVui l√≤ng n·∫°p th√™m ti·ªÅn!`);
                return;
            }

            // Th·ª±c hi·ªán tr·ª´ ti·ªÅn
            let newBalance = currentBalance - productPrice;
            localStorage.setItem('user_balance', newBalance.toString());
            
            // Render l·∫°i Header ƒë·ªÉ Update s·ªë d∆∞ hi·ªÉn th·ªã
            renderHeaderUI();

            // Sinh m√£ ƒë∆°n h√†ng Random (6 k√≠ t·ª± vi·∫øt hoa)
            let randomOrderId = Math.random().toString(36).substring(2, 8).toUpperCase();

            // Th√™m ƒë∆°n h√†ng m·ªõi v√†o m·∫£ng d·ªØ li·ªáu l·ªãch s·ª≠ (Th√™m l√™n tr√™n c√πng)
            orderHistoryData.unshift({
                id: randomOrderId,
                product: currentSelectedProduct.name
            });

            alert(`‚úÖ MUA H√ÄNG TH√ÄNH C√îNG!\n\nS·∫£n ph·∫©m: ${currentSelectedProduct.name}\nM√£ ƒë∆°n h√†ng c·ªßa b·∫°n l√†: ${randomOrderId}\nTi·ªÅn ƒë√£ tr·ª´: -${formatVND(productPrice)}ƒë`);

            // ƒê√≥ng modal s·∫£n ph·∫©m v√† m·ªü lu√¥n modal L·ªãch s·ª≠ ƒë∆°n h√†ng
            closeProductModal();
            openOrdersModal();
        }

        // --- H·ªÜ TH·ªêNG ƒêƒÇNG NH·∫¨P / ƒêƒÇNG K√ù / SIDEBAR ---
        const loginModal = document.getElementById('login-modal');
        const registerModal = document.getElementById('register-modal');
        const dropdownContent = document.getElementById('dropdown-content');
        const userHeaderInfo = document.getElementById('user-header-info');
        const sidebarModal = document.getElementById('sidebar-modal');
        const adminMenuBtn = document.getElementById('admin-menu-btn');
        const adminModal = document.getElementById('admin-modal');

        function openSidebarMenu() {
            sidebarModal.classList.remove('hidden-modal');
            const email = localStorage.getItem('db_email');
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if(isLoggedIn && email === 'taip9912@gmail.com') {
                adminMenuBtn.classList.remove('hidden');
            } else { adminMenuBtn.classList.add('hidden'); }
        }
        function closeSidebarMenu() { sidebarModal.classList.add('hidden-modal'); }

        function openAdminModal() { adminModal.classList.remove('hidden-modal'); }
        function closeAdminModal() { adminModal.classList.add('hidden-modal'); }

        function toggleUserMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('user-dropdown');
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                setTimeout(() => { dropdown.classList.remove('opacity-0', 'scale-95'); dropdown.classList.add('opacity-100', 'scale-100'); }, 10);
            } else { closeDropdown(); }
        }
        function closeDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            if (dropdown && !dropdown.classList.contains('hidden')) { dropdown.classList.remove('opacity-100', 'scale-100'); dropdown.classList.add('opacity-0', 'scale-95'); setTimeout(() => dropdown.classList.add('hidden'), 200); }
        }
        document.addEventListener('click', closeDropdown);
        function formatVND(amount) { return parseInt(amount).toLocaleString('vi-VN'); }

        function renderHeaderUI() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const savedUsername = localStorage.getItem('db_username');
            let balance = localStorage.getItem('user_balance') || '0';
            if (isLoggedIn && savedUsername) {
                userHeaderInfo.innerHTML = `<span class="text-[15px] font-bold text-yellow-400">${savedUsername}</span><span class="text-[13px] font-bold text-red-500">${formatVND(balance)}ƒë</span>`;
                dropdownContent.innerHTML = `<a href="#" class="flex items-center gap-3 px-3 py-2.5 text-white font-bold hover:bg-white/10 rounded-lg transition text-sm"><i class="fa-solid fa-user-shield w-5 text-center text-lg text-cyan-400"></i> Th√¥ng tin</a><a href="#" onclick="handleLogout(event)" class="flex items-center gap-3 px-3 py-2.5 text-red-400 font-bold hover:bg-white/10 rounded-lg transition text-sm"><i class="fa-solid fa-right-from-bracket w-5 text-center text-lg"></i> ƒêƒÉng xu·∫•t</a>`;
            } else {
                userHeaderInfo.innerHTML = `<span class="text-[15px] font-bold text-yellow-400">ƒêƒÉng nh·∫≠p</span><span class="text-[13px] font-bold text-red-500">0ƒë</span>`;
                dropdownContent.innerHTML = `<a href="#" onclick="openAuthModal('login', event)" class="flex items-center gap-3 px-3 py-2.5 text-white font-bold hover:bg-white/10 rounded-lg transition text-sm"><i class="fa-regular fa-user w-5 text-center text-lg"></i> ƒêƒÉng nh·∫≠p</a><a href="#" onclick="openAuthModal('register', event)" class="flex items-center gap-3 px-3 py-2.5 text-white font-bold hover:bg-white/10 rounded-lg transition text-sm"><i class="fa-solid fa-user-plus w-5 text-center text-lg"></i> ƒêƒÉng k√Ω</a>`;
            }
        }

        function openAuthModal(type, event) {
            if(event) event.preventDefault();
            closeDropdown();
            if(type === 'login') {
                registerModal.classList.add('hidden-modal');
                loginModal.classList.remove('hidden-modal');
                const savedUser = localStorage.getItem('db_username'); if(savedUser) document.getElementById('login-username').value = savedUser;
            } else { loginModal.classList.add('hidden-modal'); registerModal.classList.remove('hidden-modal'); }
        }
        function switchAuthModal(type) { openAuthModal(type); }
        function closeAuthModals() { loginModal.classList.add('hidden-modal'); registerModal.classList.add('hidden-modal'); }

        function handleRegister(event) {
            event.preventDefault();
            const email = document.getElementById('reg-email').value; const user = document.getElementById('reg-username').value; const pass = document.getElementById('reg-password').value;
            localStorage.setItem('db_email', email); localStorage.setItem('db_username', user); localStorage.setItem('db_password', pass);
            if(!localStorage.getItem('user_balance')) localStorage.setItem('user_balance', '0');
            alert(`ƒêƒÉng k√Ω th√†nh c√¥ng!\nEmail: ${email} ƒë√£ ƒë∆∞·ª£c l∆∞u.`);
            document.getElementById('login-username').value = user; document.getElementById('login-password').value = pass; switchAuthModal('login');
        }

        function handleLogin(event) {
            event.preventDefault();
            const inputUser = document.getElementById('login-username').value; const inputPass = document.getElementById('login-password').value;
            const dbUser = localStorage.getItem('db_username'); const dbPass = localStorage.getItem('db_password');
            if (!dbUser) { alert("T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i! Vui l√≤ng ƒëƒÉng k√Ω."); return; }
            if (inputUser === dbUser && inputPass === dbPass) {
                localStorage.setItem('isLoggedIn', 'true');
                alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!"); closeAuthModals(); renderHeaderUI();
            } else { alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!"); }
        }
        function handleLogout(event) { event.preventDefault();
            closeDropdown(); localStorage.setItem('isLoggedIn', 'false'); alert("ƒê√£ ƒëƒÉng xu·∫•t."); renderHeaderUI(); }

        // --- C√ÅC H√ÄM QU·∫¢N TR·ªä VI√äN ---
        function adminProcessTopup() { alert("ƒê√£ k·∫øt n·ªëi API th√†nh c√¥ng. Kh√¥ng c√≥ th·∫ª l·ªói ho·∫∑c h√≥a ƒë∆°n k·∫πt n√†o ·ªü th·ªùi ƒëi·ªÉm hi·ªán t·∫°i!"); }
        function adminAddBalance() {
            const user = document.getElementById('admin-add-user').value.trim();
            const amount = parseInt(document.getElementById('admin-add-amount').value);
            if(!user || isNaN(amount) || amount <= 0) return alert('Vui l√≤ng nh·∫≠p Username v√† S·ªë ti·ªÅn h·ª£p l·ªá!');
            if(user === localStorage.getItem('db_username')) {
                let currentBalance = parseInt(localStorage.getItem('user_balance') || '0');
                localStorage.setItem('user_balance', currentBalance + amount); alert(`Th√†nh c√¥ng! ƒê√£ c·ªông ${formatVND(amount)}ƒë cho t√†i kho·∫£n: ${user}`);
                renderHeaderUI(); document.getElementById('admin-add-amount').value = '';
            } else { alert('Kh√¥ng t√¨m th·∫•y Username n√†y trong CSDL Local!'); }
        }
        function adminDeleteUser() {
            const user = document.getElementById('admin-del-user').value.trim();
            if(!user) return alert('Vui l√≤ng nh·∫≠p Username c·∫ßn x√≥a!');
            if(user === localStorage.getItem('db_username')) {
                if(confirm(`C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn user "${user}" kh√¥ng?`)) {
                    localStorage.removeItem('db_username');
                    localStorage.removeItem('db_password'); localStorage.removeItem('db_email'); localStorage.removeItem('user_balance'); localStorage.setItem('isLoggedIn', 'false');
                    alert(`ƒê√£ x√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n: ${user}`); document.getElementById('admin-del-user').value = ''; renderHeaderUI(); closeAdminModal();
                }
            } else { alert('Kh√¥ng t√¨m th·∫•y Username n√†y trong h·ªá th·ªëng ƒë·ªÉ x√≥a!'); }
        }

        // --- N·∫†P TH·∫∫ & T·∫†O QR BANK ---
        const topupCardModal = document.getElementById('topup-card-modal');
        const topupBankModal = document.getElementById('topup-bank-modal');
        const invoiceModal = document.getElementById('invoice-modal');
        const qrModal = document.getElementById('qr-modal');

        function closeAllTopupModals() { topupCardModal.classList.add('hidden-modal'); topupBankModal.classList.add('hidden-modal'); }

        function openTopupCardModal() {
            if(localStorage.getItem('isLoggedIn') !== 'true') { alert('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi n·∫°p ti·ªÅn!'); return; }
            topupCardModal.classList.remove('hidden-modal'); refreshCaptcha(); calculateCardDiscount();
        }

        function calculateCardDiscount() {
            const val = document.getElementById('card-value').value;
            const display = document.getElementById('card-discount-amount');
            if(val) { let realAmount = parseInt(val) * 0.8; display.innerText = formatVND(realAmount) + 'ƒë'; } else { display.innerText = '0ƒë'; }
        }

        function refreshCaptcha() { document.getElementById('captcha-display').innerText = Math.floor(100 + Math.random() * 900); }

        function handleTopupCard(event) { event.preventDefault();
            alert('Y√™u c·∫ßu n·∫°p th·∫ª ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng! ƒêang ch·ªù h·ªá th·ªëng x·ª≠ l√Ω...'); closeAllTopupModals(); }

        function openTopupBankModal() {
            if(localStorage.getItem('isLoggedIn') !== 'true') { alert('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi n·∫°p ti·ªÅn!'); return; }
            topupBankModal.classList.remove('hidden-modal');
        }

        function openInvoiceModal() { invoiceModal.classList.remove('hidden-modal'); document.getElementById('invoice-amount').value = ''; }
        function closeInvoiceModal() { invoiceModal.classList.add('hidden-modal'); }


        // ==========================================
        // KH·ªêI X·ª¨ L√ù L·∫ÆP API NG√ÇN H√ÄNG TH·∫¨T S·ª∞ (SEPAY L√ÄM CHU·∫®N)
        // ==========================================
        let checkPaymentInterval;

        function startPaymentObserver(expectedAmount, transferContent) {
            console.log(`B·∫Øt ƒë·∫ßu g·ªçi API theo d√µi giao d·ªãch: ${transferContent} - ${expectedAmount}ƒë`);
            
            if (checkPaymentInterval) clearInterval(checkPaymentInterval);

            let attemptCount = 0;
            const maxAttempts = 180; // 15 ph√∫t (m·ªói 5s check 1 l·∫ßn)

            checkPaymentInterval = setInterval(async () => {
                attemptCount++;
                
                try {
                    // C·∫§U H√åNH API TH·∫¨T C·ª¶A B·∫†N T·∫†I ƒê√ÇY
                    // Thay th·∫ø "YOUR_SEPAY_API_TOKEN" b·∫±ng Token t√≠ch h·ª£p API m√† SePay c·∫•p cho b·∫°n
                    const API_URL = "https://my.sepay.vn/userapi/transactions/list?limit=10";
                    
                    const response = await fetch(API_URL, {
                        method: "GET",
                        headers: {
                            "Authorization": "Bearer YOUR_SEPAY_API_TOKEN", 
                            "Content-Type": "application/json"
                        }
                    });

                    // N·∫øu API l·ªói, b·ªè qua v√† ƒë·ª£i l·∫ßn qu√©t 5 gi√¢y ti·∫øp theo
                    if (!response.ok) {
                        console.warn("Ch∆∞a th·ªÉ k·∫øt n·ªëi t·ªõi API Ng√¢n h√†ng, s·∫Ω th·ª≠ l·∫°i sau 5s...");
                        return; 
                    }

                    const data = await response.json();
                    
                    // Ph√¢n t√≠ch d·ªØ li·ªáu API tr·∫£ v·ªÅ (C·∫•u tr√∫c m·∫£ng c·ªßa SePay)
                    if (data && data.transactions && data.transactions.length > 0) {
                        
                        // L·ªçc trong danh s√°ch 10 giao d·ªãch g·∫ßn nh·∫•t
                        const matchedTx = data.transactions.find(tx => 
                            tx.transaction_content && tx.transaction_content.includes(transferContent)
                        );

                        // N·∫øu t√¨m th·∫•y ƒë√∫ng N·ªôi dung CK v√† S·ªë ti·ªÅn kh√°ch n·∫°p >= s·ªë ti·ªÅn h√≥a ƒë∆°n y√™u c·∫ßu
                        if (matchedTx && parseInt(matchedTx.amount_in) >= parseInt(expectedAmount)) {
                            clearInterval(checkPaymentInterval); // D·ª´ng v√≤ng l·∫∑p l·∫°i
                            handleTopupSuccess(matchedTx.amount_in, transferContent); // G·ªçi h√†m c·ªông ti·ªÅn
                        }
                    }

                } catch (error) {
                    console.error("L·ªói khi k·∫øt n·ªëi API ng√¢n h√†ng th·∫≠t:", error);
                }

                // N·∫øu qu√©t li√™n t·ª•c trong 15 ph√∫t m√† kh√¥ng th·∫•y thanh to√°n -> t·∫Øt qu√©t.
                if (attemptCount >= maxAttempts) {
                    clearInterval(checkPaymentInterval);
                    alert("ƒê√£ h·∫øt th·ªùi gian ch·ªù thanh to√°n (15 ph√∫t). N·∫øu b·∫°n ƒë√£ chuy·ªÉn kho·∫£n, xin vui l√≤ng li√™n h·ªá Admin qua Zalo ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ c·ªông tay.");
                    closeQRModal();
                }

            }, 5000); // T·∫ßn su·∫•t g·ªçi API: 5 gi√¢y / 1 l·∫ßn
        }

        function handleTopupSuccess(amount, content) {
            let currentBalance = parseInt(localStorage.getItem('user_balance') || '0');
            let amountReceived = parseInt(amount);
            
            localStorage.setItem('user_balance', (currentBalance + amountReceived).toString());
            
            renderHeaderUI();
            
            alert(`‚úÖ N·∫†P TI·ªÄN T·ª∞ ƒê·ªòNG TH√ÄNH C√îNG!\n\nH·ªá th·ªëng API ƒë√£ x√°c nh·∫≠n ng√¢n h√†ng.\nT√†i kho·∫£n c·ªßa b·∫°n v·ª´a ƒë∆∞·ª£c c·ªông th√™m: ${formatVND(amountReceived)}ƒë.`);
            
            closeQRModal();
        }

        function generateBankQR() {
            const amountInput = document.getElementById('invoice-amount').value;
            if(!amountInput || amountInput <= 0) { alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!'); return; }
            
            // Random m√£ n·ªôi dung (v√≠ d·ª•: NAPA1B2C3)
            const randomContent = "NAP" + Math.random().toString(36).substring(2, 8).toUpperCase();
            
            document.getElementById('qr-display-amount').innerText = formatVND(amountInput) + 'ƒë';
            document.getElementById('qr-display-content').innerText = randomContent;
            document.getElementById('qr-status-text').innerText = "Tr·∫°ng th√°i: ƒêang ch·ªù thanh to√°n...";

            const bankId = "MB"; const accNo = "0905564558";
            const accName = "NGUYEN DUY PHUOC TAI";
            const qrUrl = `https://img.vietqr.io/image/${bankId}-${accNo}-compact2.png?amount=${amountInput}&addInfo=${randomContent}&accountName=${encodeURIComponent(accName)}`;
            document.getElementById('qr-dynamic-img').src = qrUrl;

            closeInvoiceModal(); closeAllTopupModals(); 
            qrModal.classList.remove('hidden-modal');
            
            // B·∫Øt ƒë·∫ßu k√≠ch ho·∫°t g·ªçi API th·∫≠t ƒë·ªÉ Check n·ªôi dung chuy·ªÉn kho·∫£n
            startPaymentObserver(amountInput, randomContent);
        }

        function closeQRModal() { 
            qrModal.classList.add('hidden-modal'); 
            if (checkPaymentInterval) {
                clearInterval(checkPaymentInterval);
            }
        }

        document.addEventListener('DOMContentLoaded', () => { renderHeaderUI(); });
    </script>
</body>
</html>
